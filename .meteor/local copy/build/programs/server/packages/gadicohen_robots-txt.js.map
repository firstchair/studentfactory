{"version":3,"file":"/packages/gadicohen:robots-txt.js","sources":["gadicohen:robots-txt/robots.js"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;AAAA,0B;AACA,2B;AACA,8B;;AAEA,kC;AACA,wB;AACA,uD;AACA,Q;AACA,4E;AACA,yF;AACA,mC;AACA,M;AACA,iD;AACA,C;;AAEA,wB;AACA,gC;AACA,iC;AACA,mC;;AAEA,+D;AACA,oB;AACA,sB;AACA,mC;AACA,4D;AACA,6B;AACA,c;AACA,E;AACA,G;;;AAGA,E;AACA,sC;AACA,wD;AACA,kC;AACA,Q;AACA,sB;AACA,e;AACA,G;AACA,E;;AAEA,U;AACA,U;AACA,E;;AAEA,oC;AACA,oD;;AAEA,4C;AACA,U;AACA,yB;;AAEA,6C;AACA,4C;AACA,oC;;AAEA,W;AACA,C;;AAEA,iC;AACA,uB;AACA,E","sourcesContent":["var pubRoot, match, stack;\nvar fs = Npm.require('fs'),\n  path = Npm.require('path'); \n\nif (__meteor_bootstrap__.bundle) {\n\t// TODO, remove in 2014\n\tpubRoot = __meteor_bootstrap__.bundle.root + 'public';\n} else {\n\tpubRoot = path.join(__meteor_bootstrap__.serverDir, '..', 'client', 'app');\n//\tWebApp.clientProgram.manifest = _.reject(WebApp.clientProgram.manifest, function(cp) {\n//\t\treturn cp.url == '/robots.txt';\n//\t});\n//\tRoutePolicy.declare('/robots.txt', 'network');\n}\n\n// TODO, remove in 2014 \nstack = __meteor_bootstrap__.app\n\t? __meteor_bootstrap__.app.stack\n    : WebApp.connectHandlers.stack;\n\n// splice necessary to jump ahead of original /robots.txt route\nstack.splice(0, 0, {\n\troute: '/robots.txt',\n\thandle: function(req, res, next) {\n\t\tfs.readFile(pubRoot + '/robots.txt', function(err, data) {\n\t\t\trobotsOut(res, err, data);\n\t\t}.future());\n\t}\n});\n\n\n/*\nvar app = typeof WebApp != 'undefined'\n    ? WebApp.connectHandlers : __meteor_bootstrap__.app;\napp.use(function(req, res, next) {\n\tLog(3);\n\tconsole.log(req.url);\n\treturn next();\n});\n*/\n\nrobots = {\n\tlines: []\n};\n\nfunction robotsOut(res, err, data) {\n\tres.writeHead(200, {'Content-Type': 'text/plain'});\n\n\t// Generally: if the file exists, serve it.\n\tif (!err)\n\t\tres.write(data + '\\n');\n\n\t// Iterate through all our other added lines\n\tfor (var i=0; i < robots.lines.length; i++)\n\t\tres.write(robots.lines[i] + '\\n');\n\n\tres.end();\n}\n\nrobots.addLine = function(line) {\n\tthis.lines.push(line);\n};\n"]}