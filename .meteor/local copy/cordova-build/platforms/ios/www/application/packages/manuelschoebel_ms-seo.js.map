)]}'
{"version":3,"file":"/packages/manuelschoebel:ms-seo.js","sources":["manuelschoebel:ms-seo/seo_collection.coffee","manuelschoebel:ms-seo/seo.coffee"],"names":[],"mappings":"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","sourcesContent":["@SeoCollection = new Mongo.Collection('seo')","SEO =\n  settings: {\n    title: ''\n    rel_author: ''\n    meta: []\n    og: []\n    twitter: []\n    ignore:\n      meta: ['fragment']\n      link: ['stylesheet', 'icon', 'apple-touch-icon']\n    auto:\n      twitter: true\n      og: true\n      set: ['description', 'url', 'title']\n  }\n\n  # e.g. ignore('meta', 'fragment')\n  ignore: (type, value) ->\n    @settings.ignore[type].push(value) if @settings.ignore[type] and _.indexOf(@settings.ignore[type], value) is -1\n\n  config: (settings) ->\n    _.extend(@settings, settings)\n\n  set: (options, clearBefore=true) ->\n    @clearAll() if clearBefore\n\n    currentRouter = Router.current()\n    url = Router.url(currentRouter.route.getName(), currentRouter.params) if currentRouter\n    #SEO.set({url: Router.url(currentRouter.route.name, currentRouter.params)})\n\n    meta = options.meta\n    og = options.og\n    link = options.link\n    twitter = options.twitter\n\n    @setTitle options.title if options.title\n\n    if options.url\n      @setUrl options.url\n    else if url\n      @setUrl url\n\n    # set meta\n    if meta and _.isArray(meta)\n      for m in meta\n        @setMeta(\"name='#{m.key}'\", m.value)\n    else if meta and _.isObject(meta)\n      for k, v of meta\n        @setMeta(\"name='#{k}'\", v)\n\n    # set og\n    if og and _.isArray(og)\n      for o in og\n        @setMeta(\"property='og:#{o.key}'\", o.value)\n    else if og and _.isObject(og)\n      for k, v of og\n        @setMeta(\"property='og:#{k}'\", v)\n\n    # set link\n    # as array {href: \"...\", rel: \"...\"}\n    # or as object {rel: href}\n    if link and _.isArray(link)\n      for l in link\n        @setLink(l.rel, l.href)\n    else if link and _.isObject(link)\n      for k, v of link\n        @setLink(k, v)\n\n    # set twitter\n    if twitter and _.isArray(twitter)\n      for o in twitter\n        @setMeta(\"property='twitter:#{o.key}'\", o.value)\n    else if twitter and _.isObject(twitter)\n      for k, v of twitter\n        @setMeta(\"property='twitter:#{k}'\", v)\n\n    # set google+ rel author\n    @setLink 'author', options.rel_author if options.rel_author\n\n  clearAll: ->\n    for m in $(\"meta\")\n      $m = $(m)\n      # do not remove anything you do not control\n      # MS Seo only sets metas with a name or property\n      # Probably not the best solution\n      controlled = $m.attr('name') or $m.attr('property')\n      ignored = false\n      if $m.attr('name') and _.indexOf(SEO.settings.ignore.meta, $m.attr('name')) > -1\n        ignored = true\n      else if $m.attr('property') and _.indexOf(SEO.settings.ignore.meta, $m.attr('property')) > -1\n        ignored = true\n      if not ignored and controlled\n        $m.remove()\n    for l in $(\"link\")\n      $l = $(l)\n      controlled = $l.attr 'rel'\n      $l.remove() if _.indexOf(SEO.settings.ignore.link, $l.attr('rel')) is -1 and controlled\n    @set(@settings, false)\n    @setTitle(@settings.title)\n\n  setTitle: (title) ->\n    document.title = title\n    if _.indexOf(@settings.auto.set, 'title') isnt -1\n      if @settings.auto.twitter\n        @setMeta 'property=\"twitter:title\"', title\n      if @settings.auto.og\n        @setMeta 'property=\"og:title\"', title\n\n  setUrl: (url) ->\n    if _.indexOf(@settings.auto.set, 'url') isnt -1\n      if @settings.auto.twitter\n        @setMeta 'property=\"twitter:url\"', url\n      if @settings.auto.og\n        @setMeta 'property=\"og:url\"', url\n\n  setLink: (rel, href, unique=true) ->\n    @removeLink(rel) if unique\n    if _.isArray(href)\n      for h in href\n        @setLink(rel, h, false)\n      return\n\n    if href\n      $('head').append(\"<link rel='#{rel}' href='#{href}'>\")\n\n  removeLink: (rel) ->\n    $(\"link[rel='#{rel}']\").remove()\n\n  setMeta: (attr, content, unique=true) ->\n    @removeMeta(attr) if unique\n    if _.isArray(content)\n      for v in content\n        @setMeta(attr, v, false)\n      return\n\n    return unless content\n    content = escapeHtmlAttribute(content)\n\n    $('head').append(\"<meta #{attr} content='#{content}'>\")\n\n    name = attr.replace(/\"|'/g, '').split('=')[1]\n    if _.indexOf(@settings.auto.set, name) isnt -1\n      if @settings.auto.twitter\n        @setMeta \"property='twitter:#{name}'\", content\n      if @settings.auto.og\n        @setMeta \"property='og:#{name}'\", content\n\n  removeMeta: (attr) ->\n    $(\"meta[#{attr}]\").remove()\n\n\n@SEO = SEO\n\nescapeHtmlAttribute = (string) ->\n  return (\"\" + string).replace(/'/g, \"&apos;\").replace(/\"/g, \"&quot;\")\n\ngetCurrentRouteName = ->\n  router = Router.current()\n  return unless router\n  routeName = router.route.getName()\n  return routeName\n\n# Get seo settings depending on route\nDeps.autorun( ->\n  currentRouteName = getCurrentRouteName()\n  return unless currentRouteName\n  Meteor.subscribe('seoByRouteName', currentRouteName)\n)\n\n# Set seo settings depending on route\nDeps.autorun( ->\n  return unless SEO\n  currentRouteName = getCurrentRouteName()\n  settings = SeoCollection.findOne({route_name: currentRouteName}) or {}\n  SEO.set(settings)\n)\n"]}